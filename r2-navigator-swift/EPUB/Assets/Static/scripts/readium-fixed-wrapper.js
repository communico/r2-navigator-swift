(()=>{var __webpack_modules__={653:()=>{eval("//\n//  Copyright 2021 Readium Foundation. All rights reserved.\n//  Use of this source code is governed by the BSD-style license\n//  available in the top-level LICENSE file of the project.\n//\n\n// Script used for the wrapper HTML pages of fixed layouts resources.\n\nreadium.FixedPage = function(iframeId) {\n    // Fixed dimensions for the page, extracted from the viewport meta tag.\n    var _pageSize = null;\n    // Available viewport size to fill with the resource.\n    var _viewportSize = null;\n    // Margins that should not overlap the content.\n    var _safeAreaInsets = null;\n\n    // iFrame containing the page.\n    var _iframe = document.getElementById(iframeId);\n    _iframe.addEventListener('load', loadPageSize);\n\n    // Viewport element containing the iFrame.\n    var _viewport = _iframe.closest('.viewport')\n\n    // Parses the page size from the viewport meta tag of the loaded resource.\n    function loadPageSize() {\n        var viewport = _iframe.contentWindow.document.querySelector('meta[name=viewport]');\n        if (!viewport) {\n            return;\n        }\n        var regex = /(\\w+) *= *([^\\s,]+)/g\n        var properties = {};\n        var match;\n        while (match = regex.exec(viewport.content)) {\n            properties[match[1]] = match[2];\n        }\n        var width = Number.parseFloat(properties.width);\n        var height = Number.parseFloat(properties.height);\n        if (width && height) {\n            _pageSize = { 'width': width, 'height': height };\n            layoutPage();\n        }\n    }\n\n    // Layouts the page iframe to center its content and scale it to fill the available viewport.\n    function layoutPage() {\n        if (!_pageSize || !_viewportSize || !_safeAreaInsets) {\n            return;\n        }\n\n        _iframe.style.width = _pageSize.width + 'px';\n        _iframe.style.height = _pageSize.height + 'px';\n        _iframe.style.marginTop = (_safeAreaInsets.top - _safeAreaInsets.bottom) + 'px';\n        _iframe.style.marginLeft = (_safeAreaInsets.left - _safeAreaInsets.right) + 'px';\n\n        // Calculates the zoom scale required to fit the content to the viewport.\n        var widthRatio = _viewportSize.width / _pageSize.width;\n        var heightRatio = _viewportSize.height / _pageSize.height;\n        var scale = Math.min(widthRatio, heightRatio);\n\n        // Sets the viewport of the wrapper page (this page) to scale the iframe.\n        var viewport = document.querySelector('meta[name=viewport]');\n        viewport.content = 'initial-scale=' + scale + ', minimum-scale=' + scale;\n    }\n\n    return {\n        // Returns whether the page is currently loading its contents.\n        'isLoading': false,\n\n        // Href of the resource currently loaded in the page.\n        'href': null,\n\n        // Loads the given link ({href, url}) in the page.\n        'load': function(link, completion) {\n            if (!link.href || !link.url) {\n                if (completion) { completion(); }\n                return;\n            }\n\n            var page = this;\n            page.href = link.href;\n            page.isLoading = true;\n\n            function loaded() {\n                _iframe.removeEventListener('load', loaded);\n\n                // Waiting for the next animation frame seems to do the trick to make sure the page is fully rendered.\n                _iframe.contentWindow.requestAnimationFrame(function() {\n                    page.isLoading = false;\n                    if (completion) { completion(); }\n                });\n            }\n\n            _iframe.addEventListener('load', loaded);\n            _iframe.src = link.url;\n        },\n\n        // Resets the page and empty its contents.\n        'reset': function() {\n            if (!this.href) {\n                return;\n            }\n            this.href = null;\n            _pageSize = null;\n            _iframe.src = 'about:blank';\n        },\n\n        // Evaluates a script in the context of the page.\n        'eval': function(script) {\n            if (!this.href || this.isLoading) {\n                return;\n            }\n            return _iframe.contentWindow.eval(script);\n        },\n\n        // Updates the available viewport to display the resource.\n        'setViewport': function(viewportSize, safeAreaInsets) {\n            _viewportSize = viewportSize;\n            _safeAreaInsets = safeAreaInsets;\n            layoutPage();\n        },\n\n        // Shows the page's viewport.\n        'show': function() {\n            _viewport.style.display = 'block';\n        },\n\n        // Hides the page's viewport.\n        'hide': function() {\n            _viewport.style.display = 'none';\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yZWFkaXVtLWpzLy4vc3JjL2luZGV4LWZpeGVkLXdyYXBwZXIuanM/NzM2NCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxrQ0FBa0MsVUFBVTtBQUM1QztBQUNBO0FBQ0EsaUNBQWlDLGNBQWM7QUFDL0M7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsY0FBYztBQUNuRCxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiI2NTMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL1xuLy8gIENvcHlyaWdodCAyMDIxIFJlYWRpdW0gRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSB0aGUgQlNELXN0eWxlIGxpY2Vuc2Vcbi8vICBhdmFpbGFibGUgaW4gdGhlIHRvcC1sZXZlbCBMSUNFTlNFIGZpbGUgb2YgdGhlIHByb2plY3QuXG4vL1xuXG4vLyBTY3JpcHQgdXNlZCBmb3IgdGhlIHdyYXBwZXIgSFRNTCBwYWdlcyBvZiBmaXhlZCBsYXlvdXRzIHJlc291cmNlcy5cblxucmVhZGl1bS5GaXhlZFBhZ2UgPSBmdW5jdGlvbihpZnJhbWVJZCkge1xuICAgIC8vIEZpeGVkIGRpbWVuc2lvbnMgZm9yIHRoZSBwYWdlLCBleHRyYWN0ZWQgZnJvbSB0aGUgdmlld3BvcnQgbWV0YSB0YWcuXG4gICAgdmFyIF9wYWdlU2l6ZSA9IG51bGw7XG4gICAgLy8gQXZhaWxhYmxlIHZpZXdwb3J0IHNpemUgdG8gZmlsbCB3aXRoIHRoZSByZXNvdXJjZS5cbiAgICB2YXIgX3ZpZXdwb3J0U2l6ZSA9IG51bGw7XG4gICAgLy8gTWFyZ2lucyB0aGF0IHNob3VsZCBub3Qgb3ZlcmxhcCB0aGUgY29udGVudC5cbiAgICB2YXIgX3NhZmVBcmVhSW5zZXRzID0gbnVsbDtcblxuICAgIC8vIGlGcmFtZSBjb250YWluaW5nIHRoZSBwYWdlLlxuICAgIHZhciBfaWZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWZyYW1lSWQpO1xuICAgIF9pZnJhbWUuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGxvYWRQYWdlU2l6ZSk7XG5cbiAgICAvLyBWaWV3cG9ydCBlbGVtZW50IGNvbnRhaW5pbmcgdGhlIGlGcmFtZS5cbiAgICB2YXIgX3ZpZXdwb3J0ID0gX2lmcmFtZS5jbG9zZXN0KCcudmlld3BvcnQnKVxuXG4gICAgLy8gUGFyc2VzIHRoZSBwYWdlIHNpemUgZnJvbSB0aGUgdmlld3BvcnQgbWV0YSB0YWcgb2YgdGhlIGxvYWRlZCByZXNvdXJjZS5cbiAgICBmdW5jdGlvbiBsb2FkUGFnZVNpemUoKSB7XG4gICAgICAgIHZhciB2aWV3cG9ydCA9IF9pZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9dmlld3BvcnRdJyk7XG4gICAgICAgIGlmICghdmlld3BvcnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVnZXggPSAvKFxcdyspICo9ICooW15cXHMsXSspL2dcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB7fTtcbiAgICAgICAgdmFyIG1hdGNoO1xuICAgICAgICB3aGlsZSAobWF0Y2ggPSByZWdleC5leGVjKHZpZXdwb3J0LmNvbnRlbnQpKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzW21hdGNoWzFdXSA9IG1hdGNoWzJdO1xuICAgICAgICB9XG4gICAgICAgIHZhciB3aWR0aCA9IE51bWJlci5wYXJzZUZsb2F0KHByb3BlcnRpZXMud2lkdGgpO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gTnVtYmVyLnBhcnNlRmxvYXQocHJvcGVydGllcy5oZWlnaHQpO1xuICAgICAgICBpZiAod2lkdGggJiYgaGVpZ2h0KSB7XG4gICAgICAgICAgICBfcGFnZVNpemUgPSB7ICd3aWR0aCc6IHdpZHRoLCAnaGVpZ2h0JzogaGVpZ2h0IH07XG4gICAgICAgICAgICBsYXlvdXRQYWdlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBMYXlvdXRzIHRoZSBwYWdlIGlmcmFtZSB0byBjZW50ZXIgaXRzIGNvbnRlbnQgYW5kIHNjYWxlIGl0IHRvIGZpbGwgdGhlIGF2YWlsYWJsZSB2aWV3cG9ydC5cbiAgICBmdW5jdGlvbiBsYXlvdXRQYWdlKCkge1xuICAgICAgICBpZiAoIV9wYWdlU2l6ZSB8fCAhX3ZpZXdwb3J0U2l6ZSB8fCAhX3NhZmVBcmVhSW5zZXRzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBfaWZyYW1lLnN0eWxlLndpZHRoID0gX3BhZ2VTaXplLndpZHRoICsgJ3B4JztcbiAgICAgICAgX2lmcmFtZS5zdHlsZS5oZWlnaHQgPSBfcGFnZVNpemUuaGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgX2lmcmFtZS5zdHlsZS5tYXJnaW5Ub3AgPSAoX3NhZmVBcmVhSW5zZXRzLnRvcCAtIF9zYWZlQXJlYUluc2V0cy5ib3R0b20pICsgJ3B4JztcbiAgICAgICAgX2lmcmFtZS5zdHlsZS5tYXJnaW5MZWZ0ID0gKF9zYWZlQXJlYUluc2V0cy5sZWZ0IC0gX3NhZmVBcmVhSW5zZXRzLnJpZ2h0KSArICdweCc7XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlcyB0aGUgem9vbSBzY2FsZSByZXF1aXJlZCB0byBmaXQgdGhlIGNvbnRlbnQgdG8gdGhlIHZpZXdwb3J0LlxuICAgICAgICB2YXIgd2lkdGhSYXRpbyA9IF92aWV3cG9ydFNpemUud2lkdGggLyBfcGFnZVNpemUud2lkdGg7XG4gICAgICAgIHZhciBoZWlnaHRSYXRpbyA9IF92aWV3cG9ydFNpemUuaGVpZ2h0IC8gX3BhZ2VTaXplLmhlaWdodDtcbiAgICAgICAgdmFyIHNjYWxlID0gTWF0aC5taW4od2lkdGhSYXRpbywgaGVpZ2h0UmF0aW8pO1xuXG4gICAgICAgIC8vIFNldHMgdGhlIHZpZXdwb3J0IG9mIHRoZSB3cmFwcGVyIHBhZ2UgKHRoaXMgcGFnZSkgdG8gc2NhbGUgdGhlIGlmcmFtZS5cbiAgICAgICAgdmFyIHZpZXdwb3J0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPXZpZXdwb3J0XScpO1xuICAgICAgICB2aWV3cG9ydC5jb250ZW50ID0gJ2luaXRpYWwtc2NhbGU9JyArIHNjYWxlICsgJywgbWluaW11bS1zY2FsZT0nICsgc2NhbGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgLy8gUmV0dXJucyB3aGV0aGVyIHRoZSBwYWdlIGlzIGN1cnJlbnRseSBsb2FkaW5nIGl0cyBjb250ZW50cy5cbiAgICAgICAgJ2lzTG9hZGluZyc6IGZhbHNlLFxuXG4gICAgICAgIC8vIEhyZWYgb2YgdGhlIHJlc291cmNlIGN1cnJlbnRseSBsb2FkZWQgaW4gdGhlIHBhZ2UuXG4gICAgICAgICdocmVmJzogbnVsbCxcblxuICAgICAgICAvLyBMb2FkcyB0aGUgZ2l2ZW4gbGluayAoe2hyZWYsIHVybH0pIGluIHRoZSBwYWdlLlxuICAgICAgICAnbG9hZCc6IGZ1bmN0aW9uKGxpbmssIGNvbXBsZXRpb24pIHtcbiAgICAgICAgICAgIGlmICghbGluay5ocmVmIHx8ICFsaW5rLnVybCkge1xuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0aW9uKSB7IGNvbXBsZXRpb24oKTsgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHBhZ2UgPSB0aGlzO1xuICAgICAgICAgICAgcGFnZS5ocmVmID0gbGluay5ocmVmO1xuICAgICAgICAgICAgcGFnZS5pc0xvYWRpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBsb2FkZWQoKSB7XG4gICAgICAgICAgICAgICAgX2lmcmFtZS5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgbG9hZGVkKTtcblxuICAgICAgICAgICAgICAgIC8vIFdhaXRpbmcgZm9yIHRoZSBuZXh0IGFuaW1hdGlvbiBmcmFtZSBzZWVtcyB0byBkbyB0aGUgdHJpY2sgdG8gbWFrZSBzdXJlIHRoZSBwYWdlIGlzIGZ1bGx5IHJlbmRlcmVkLlxuICAgICAgICAgICAgICAgIF9pZnJhbWUuY29udGVudFdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2UuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb21wbGV0aW9uKSB7IGNvbXBsZXRpb24oKTsgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfaWZyYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBsb2FkZWQpO1xuICAgICAgICAgICAgX2lmcmFtZS5zcmMgPSBsaW5rLnVybDtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBSZXNldHMgdGhlIHBhZ2UgYW5kIGVtcHR5IGl0cyBjb250ZW50cy5cbiAgICAgICAgJ3Jlc2V0JzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaHJlZikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaHJlZiA9IG51bGw7XG4gICAgICAgICAgICBfcGFnZVNpemUgPSBudWxsO1xuICAgICAgICAgICAgX2lmcmFtZS5zcmMgPSAnYWJvdXQ6YmxhbmsnO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIEV2YWx1YXRlcyBhIHNjcmlwdCBpbiB0aGUgY29udGV4dCBvZiB0aGUgcGFnZS5cbiAgICAgICAgJ2V2YWwnOiBmdW5jdGlvbihzY3JpcHQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5ocmVmIHx8IHRoaXMuaXNMb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF9pZnJhbWUuY29udGVudFdpbmRvdy5ldmFsKHNjcmlwdCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gVXBkYXRlcyB0aGUgYXZhaWxhYmxlIHZpZXdwb3J0IHRvIGRpc3BsYXkgdGhlIHJlc291cmNlLlxuICAgICAgICAnc2V0Vmlld3BvcnQnOiBmdW5jdGlvbih2aWV3cG9ydFNpemUsIHNhZmVBcmVhSW5zZXRzKSB7XG4gICAgICAgICAgICBfdmlld3BvcnRTaXplID0gdmlld3BvcnRTaXplO1xuICAgICAgICAgICAgX3NhZmVBcmVhSW5zZXRzID0gc2FmZUFyZWFJbnNldHM7XG4gICAgICAgICAgICBsYXlvdXRQYWdlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gU2hvd3MgdGhlIHBhZ2UncyB2aWV3cG9ydC5cbiAgICAgICAgJ3Nob3cnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF92aWV3cG9ydC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBIaWRlcyB0aGUgcGFnZSdzIHZpZXdwb3J0LlxuICAgICAgICAnaGlkZSc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX3ZpZXdwb3J0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIH1cbiAgICB9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///653\n")}},__webpack_exports__={};__webpack_modules__[653]()})();